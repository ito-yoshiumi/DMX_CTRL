# Encounter with the unknown — Cursor Kickoff Pack
*(generated 2025-11-14)*

このパックは、**AI コードエディタ「Cursor」**で「Encounter with the unknown」を素早く立ち上げるためのキックオフ資料＋最小スキャフォールドです。

---

## 0) プロジェクトの芯
- **体験**：スピーカー（合成/事前WAV）⇄ マイク入力（声/テルミン/オタマトーン）⇄ **DMXキネティックライト(ホイスト)** が「音で会話」する。
- **テーマ**：未知との共生・調和（『未知との遭遇』の5音と『かえるのうた』輪唱がモチーフ）。
- **対象**：小学生＋家族。
- **装置前提**：DMX ホイスト（値255=約7m、100=約3m）。RGB で色変化。

---

## 1) シナリオ（最小案）
**ループ1（来客前）**
1. 合成音声「わたしはみちのせいめいたい」＋ライト点灯
2. 5音シグナルを再生（ライトが同期動作）
3. 「あなたのあいさつもきかせて。さあマイクのまえにたって」

**ループ2（来客後）**
1. オペレータが Enter → 「『わー』と言ってみて」
2. **音量/音程**に反応して 5台が上下/色変化
3. 「ドレミファソ」と歌ってみて → **低→高**の上下演出
4. 5音シグナルを**真似して1音ずつ録音×5**
5. **お手本＋参加者の声**を同時再生、ライトが共演
6. しめの一言 → 次の来場者待ち

> `docs/Scenario/scenario_ja.json` と `docs/Cues/*.json` に最小のサンプルを同梱。

---

## 2) 音声の鳴らし方（実装ポリシー）
### ハイブリッド方式（推奨）
- **台本が固定**でタイミング命のセリフ / 5音：**事前WAV**
- **誘導・多言語・名前呼び**：**ランタイムTTS**（起動時に合成→WAVキャッシュ）

### TTS 選択肢
- **VOICEVOX**（Mac, 無料, 歌唱可）…歌や日本語トークに最適。ローカル HTTP API。
- **COEIROINK**（Mac, 無料, トーク特化）…誘導セリフをローカル合成。
- （必要があれば Azure/ELEVEN などのクラウド TTS も併用。展示では回線リスク回避のため**起動時キャッシュ**が必須）

### 再生/同期
- 再生は **AudioSource**（Timeline/Playable でキュー）
- **ScenarioRunner** が JSON を読み、`type:"wav"` は事前配置、`type:"tts"` はキャッシュから取得。
- 音声再生開始で **CuePlayer** が DMX キュー（高さ/色のキー フレーム）を走らせる。

---

## 3) 音→ライトのマッピング
### ピッチ(Hz)→高さ(DMX 100..255)
1. `midi = 69 + 12 * log2(f/440)`
2. `t = saturate( (midi - midiMin) / (midiMax - midiMin) )`  *(初期: C4..C6)*
3. `dmxHeight = round( lerp(100, 255, t) )`
4. **スムージング**（0.2–0.4s）と **速度/加速度リミット**を必ず適用。

### 音量(RMS 0..1)→色(RGB)
- `hue = lerp(0.6, 0.0, rms)`（小=青→大=赤）
- HSV→RGB 変換 → DMX の R/G/B チャンネルへ。

---

## 4) 安全・運用
- **可動域クランプ**：DMX 100–255（物理LIMとも整合）
- **速度/加速度上限**・**非常停止**（E‑Stop）
- **通信冗長**：ネット不調時は TTS キャッシュ＋事前WAVのみで完結
- **ログ**：例外、E‑Stop、セッション数、推定ピッチ分布 など

---

## 5) フォルダとファイル
- `docs/Scenario/scenario_ja.json` …… 最小シナリオ
- `docs/Cues/intro_light.json` …… オープニング用キー フレーム
- `docs/Cues/5note_light.json` …… 5音モチーフ用キー フレーム
- `docs/Tasks/todo.md` …… Cursorでの実装タスク順
- `unity_scaffold/Assets/Scripts/...` …… 空クラス雛形（後述の TODO を埋めてMVPへ）

---

## 6) MVP 作業順（Cursor 推奨手順）
1. **ArtNetClient**：UDP送出（固定 512ch を 30Hz 送るスタブでも可）
2. **KineticLightController**：`SetFixtureHeight/Color` → `Apply()` で送信
3. **CuePlayer**：JSON キー フレームを補間適用（線形でOK）
4. **ScenarioRunner**：WAV 再生→Cue開始→待機 / TTS キャッシュ読み出し
5. **AudioInputManager**：RMS と簡易ピッチ（後でYIN実装）→ マッピング

---

## 7) 将来の拡張
- VOICEVOX 歌唱パートで**輪唱**を段階入替（カノン）
- **ガイダンスの多言語**切替（日本語/英語/中国語 など）
- **安全フェンス検知**（赤外/ToF）→ 可動域のリアルタイム縮小
- **セッションの保存**（参加者5音の波形を残し、来場記録に）

---

Happy building!
